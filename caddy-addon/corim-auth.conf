# CorIM Auth - GoTrue authentication service
# auth.corimd.hcai42.com routes to GoTrue with proper path handling

http://auth.corimd.hcai42.com {
    # /auth/v1/* routes to GoTrue (strip /auth/v1 prefix)
    handle /auth/v1/* {
        uri strip_prefix /auth/v1
        reverse_proxy corim-auth:9999 {
            header_up Host {host}
            header_up X-Real-IP {remote_host}
            header_up X-Forwarded-Proto https
        }
    }
    
    # /callback routes directly to GoTrue
    handle /callback* {
        reverse_proxy corim-auth:9999 {
            header_up Host {host}
            header_up X-Real-IP {remote_host}
            header_up X-Forwarded-Proto https
        }
    }
    
    # All other paths go to GoTrue directly
    handle {
        reverse_proxy corim-auth:9999 {
            header_up Host {host}
            header_up X-Real-IP {remote_host}
            header_up X-Forwarded-Proto https
        }
    }
}
