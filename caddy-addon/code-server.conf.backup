# Code-server reverse proxy with subdomain-based routing
# Cloudflare handles SSL/TLS termination, so use HTTP internally
# Subdomain routing: https://{port}.vcj.hcai42.com/
# Code-server's proxy-domain feature handles routing to individual services
# Use http:// to prevent automatic HTTPS (Cloudflare Tunnel handles SSL)

# Main code-server domain
http://vcj.hcai42.com {
    reverse_proxy 192.168.178.243:8888 {
        header_up X-Forwarded-Proto https
        header_up X-Forwarded-Host {host}
        header_up X-Forwarded-For {remote_host}
        header_up X-Real-IP {remote_host}
        # WebSocket support
        header_up Connection "upgrade"
        header_up Upgrade "websocket"
    }
}

# Wildcard subdomains - all proxied through code-server
# Code-server uses proxy-domain feature to route to actual services
http://*.vcj.hcai42.com {
    reverse_proxy 192.168.178.243:8888 {
        header_up X-Forwarded-Proto https
        header_up X-Forwarded-Host {host}
        header_up X-Forwarded-For {remote_host}
        header_up X-Real-IP {remote_host}
        # WebSocket support
        header_up Connection "upgrade"
        header_up Upgrade "websocket"
    }
}
